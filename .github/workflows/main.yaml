name: Github Actions run file demo
on:
  workflow_dispatch:
    inputs: 
      environment: 
        description: "Environment name"
        required: true
        type: string

jobs:
  upgrade:
    runs-on: ubuntu-latest
    steps:
      - name: Code Checkout
        uses: actions/checkout@v5

      - name: Setup Logging
        run: |
          mkdir -p logs
          LOG_FILE="logs/upgrade-$(date +%Y%m%d-%H%M%S).log"
          echo "LOG_FILE=$LOG_FILE" >> $GITHUB_ENV

      - name: Execute Upgrade
        run: |
          {
            echo "=========================================="
            echo "Upgrade Execution Log"
            echo "Date: $(date)"
            echo "Triggered by: ${{ github.actor }}"
            echo "Run number: ${{ github.run_number }}"
            echo "=========================================="
            echo ""
            
            # Your upgrade commands here
            bash upgrade-script.sh "${{ inputs.environment }}"
            
            EXIT_COE=$?
            echo ""
            echo "=========================================="
            echo "Upgrade completed at: $(date)"
            echo "Exit code: $?"
            echo "=========================================="
          } 2>&1 | tee ${{ env.LOG_FILE }}

      - name: Send Email
        uses: dawidd6/action-send-mail@v3
        with:
          server-address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "Upgrade Automation ${{ env.STATUS }} - ${{ env.TIMESTAMP }}"
          to: your-team@company.com
          from: github-actions@yourcompany.com
          body: |
            Upgrade automation run completed.

            Status: ${{ env.STATUS }}
            Date: ${{ env.TIMESTAMP }}
            Triggered by: ${{ github.actor }}
            Run number: ${{ github.run_number }}

            Workflow run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}

            Please find the detailed log file attached.
          attachments: ${{ env.LOG_FILE }}

      - name: Upload logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: upgrade-log-${{ github.run_number }}-${{ github.run_attempt }}
          path: ${{ env.LOG_FILE }}
          retention-days: 180
